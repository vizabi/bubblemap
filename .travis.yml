language: node_js
dist: trusty
sudo: true
node_js:
- 7.5.0
addons:
  apt:
    packages:
    - python-pip
notifications:
  email: false
  slack:
    rooms:
    - gapminder:siB4Z9ymsYR6qHnRPpgUoB2Q#vizabi-spam
    on_success: change
    on_failure: always
cache:
  directories:
  - node_modules
before_install:
- npm install -g npm@latest
- sudo pip install s3cmd
before_script:
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- npm run build
script:
- npm run deploy
deploy:
  skip_cleanup: true
  provider: npm
  email: kgrpwnz@gmail.com
  api_key:
    secure: hVftS9MAhTQaquNjJTss5z8eOX0iw1lFU43tohaa93Y1YQ7Jb1epd5lmjbIJqWtE9ujy746SsiAVbzzjMERBo6xVLBtjbdryK8aWct8mcA7FhHPXXbyqC705A+kE02kMvdAOLnnJ48x9FeoyXOAij0r8HAf+Qx60x4STypmPEEn/J++E7Wnhm1/tu5dwhCwl8Awjo7AsmOnN3+m2E69MoTx3kBp/riWafEjmr4G9l60L2ZqxNhP4pFWNeq7ZOP+1wJWQLSTymkz8CUnof0k6rjPTUEmbU5cRKrNn1ks6+l8JI05X+ZNX0MCJUJFfEZ9W3LQ5OE0d3NbLslbuIfB4vEBe8+YEi/hrzszjW+jWyEbIF3cMpZmFnd56UI+3HKf8jIyISeRBdcpUdWdlTkB28oQfFP+ApWenaVw/cWYVcbFVuweZfkxTukKUsPhWf5AMJiI3bBP4AEtCpEjYNOPOiklpp7RZKSnWdz+1UDJ3ZnlWrdrqGPbpSg/tn+2QdDZDoCWv3xLo47gTxxXmmjpX1GkHySuB0gsSAcXkyFwm4sQwDNzgCNlgAwKfRcUKabB7ORJjR+vBm8Kj7IBZmb8nmr0YmXOWOzoeLAJ30T/sgTuSTFEXPi8As5Uk/iXWT3pWEavpYvwE9Ml8EdOxzmlZNwDqgLQMI2aNuMsEGgAeH5c=
  on:
    branch: develop
    node: 7.5.0
    condition: "-e /tmp/deployment.flag"
